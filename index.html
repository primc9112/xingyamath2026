<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•¸åˆ—æ¢ç´¢å¯¦é©—å®¤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes bounceIn { 0% { transform: scale(0.9); opacity: 0; } 70% { transform: scale(1.05); } 100% { transform: scale(1); opacity: 1; } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .animate-bounce-in { animation: bounceIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .animate-shake { animation: shake 0.2s ease-in-out 0s 2; }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // åœ–æ¨™å°è£çµ„ä»¶
        const Icon = ({ name, className = "" }) => {
            useEffect(() => { lucide.createIcons(); }, []);
            return <i data-lucide={name} className={className}></i>;
        };

        // --- ä¸»ç¨‹å¼ç¢¼ ---
        const SequenceLab = () => {
            const [activeTab, setActiveTab] = useState('arithmetic');
            useEffect(() => { lucide.createIcons(); }, [activeTab]);

            return (
                <div className="min-h-screen font-sans text-slate-800">
                    <header className="bg-white border-b border-slate-200 sticky top-0 z-10 shadow-sm">
                        <div className="max-w-6xl mx-auto px-4 py-4 flex flex-col md:flex-row items-center justify-between gap-4">
                            <div className="flex items-center gap-2">
                                <div className="p-2 bg-blue-600 rounded-lg text-white">
                                    <Icon name="calculator" />
                                </div>
                                <h1 className="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-700 to-indigo-600">æ•¸åˆ—æ¢ç´¢å¯¦é©—å®¤</h1>
                            </div>
                            <nav className="flex p-1 bg-slate-100 rounded-xl">
                                {[
                                    { id: 'arithmetic', label: 'ç­‰å·®éšæ¢¯', icon: 'layers' },
                                    { id: 'geometric', label: 'ç­‰æ¯”çˆ†ç™¼', icon: 'trending-up' },
                                    { id: 'challenge', label: 'è¦å¾‹æŒ‘æˆ°', icon: 'help-circle' },
                                ].map((tab) => (
                                    <button key={tab.id} onClick={() => setActiveTab(tab.id)}
                                        className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${activeTab === tab.id ? 'bg-white text-blue-600 shadow-md' : 'text-slate-500 hover:bg-slate-200'}`}>
                                        <Icon name={tab.icon} className="w-4 h-4" />{tab.label}
                                    </button>
                                ))}
                            </nav>
                        </div>
                    </header>
                    <main className="max-w-6xl mx-auto px-4 py-8">
                        {activeTab === 'arithmetic' && <ArithmeticMode />}
                        {activeTab === 'geometric' && <GeometricMode />}
                        {activeTab === 'challenge' && <ChallengeMode />}
                    </main>
                </div>
            );
        };

        // --- ç­‰å·®æ•¸åˆ—çµ„ä»¶ ---
        const ArithmeticMode = () => {
            const [a1, setA1] = useState(2);
            const [d, setD] = useState(2);
            const [n, setN] = useState(5);
            const [showSumProof, setShowSumProof] = useState(false);
            const sequence = Array.from({ length: n }, (_, i) => a1 + i * d);
            const lastTerm = a1 + (n - 1) * d;
            const sum = (n * (a1 + lastTerm)) / 2;

            return (
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 animate-fade-in">
                    <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                        <h2 className="text-xl font-bold mb-4 flex items-center gap-2"><Icon name="layers" className="text-blue-500" /> åƒæ•¸è¨­å®š</h2>
                        <div className="space-y-6">
                            <div>é¦–é … (aâ‚): <span className="font-bold text-blue-600">{a1}</span><input type="range" min="1" max="10" value={a1} onChange={e=>setA1(parseInt(e.target.value))} className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer mt-2" /></div>
                            <div>å…¬å·® (d): <span className="font-bold text-blue-600">{d}</span><input type="range" min="-5" max="5" value={d} onChange={e=>setD(parseInt(e.target.value))} className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer mt-2" /></div>
                            <div>é …æ•¸ (n): <span className="font-bold text-blue-600">{n}</span><input type="range" min="2" max="20" value={n} onChange={e=>setN(parseInt(e.target.value))} className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer mt-2" /></div>
                            <button onClick={() => setShowSumProof(!showSumProof)} className={`w-full py-3 rounded-xl border ${showSumProof ? 'bg-orange-50 text-orange-700 border-orange-200' : 'bg-slate-50'}`}>
                                {showSumProof ? 'éš±è—é«˜æ–¯æ‹¼åœ–' : 'é¡¯ç¤ºç¸½å’Œé­”æ³• (é«˜æ–¯æ‹¼åœ–)'}
                            </button>
                        </div>
                    </div>
                    <div className="lg:col-span-2 space-y-6">
                        <div className="bg-white p-6 rounded-2xl border min-h-[400px] flex flex-col items-center justify-end relative overflow-hidden">
                            <div className="flex items-end gap-2 pb-8">
                                {sequence.map((val, idx) => (
                                    <div key={idx} className="flex flex-col items-center w-8 sm:w-12">
                                        <div className="bg-blue-500 w-full rounded-t-md relative group" style={{ height: `${Math.abs(val) * 15}px` }}>
                                            <div className="absolute -top-8 left-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 bg-slate-800 text-white text-xs px-2 py-1 rounded">{val}</div>
                                            {showSumProof && <div className="absolute bottom-full w-full bg-orange-400 opacity-80 border-t border-white" style={{ height: `${Math.abs(lastTerm + a1 - val) * 15}px` }}></div>}
                                        </div>
                                        <span className="text-[10px] mt-1 text-slate-400">n={idx+1}</span>
                                    </div>
                                ))}
                            </div>
                            {showSumProof && <div className="absolute top-4 right-4 bg-orange-50 p-3 rounded-lg border border-orange-200 text-xs animate-bounce-in">çŸ©å½¢ç¸½é¢ç© = n Ã— (é¦–é …+æœ«é …)</div>}
                        </div>
                        <div className="grid grid-cols-2 gap-4">
                            <div className="bg-blue-50 p-4 rounded-xl text-center">
                                <p className="text-sm text-blue-800">ç¬¬ n é …</p>
                                <p className="text-2xl font-bold text-blue-600">{lastTerm}</p>
                            </div>
                            <div className="bg-indigo-50 p-4 rounded-xl text-center">
                                <p className="text-sm text-indigo-800">ç¸½å’Œ Sâ‚™</p>
                                <p className="text-2xl font-bold text-indigo-600">{sum}</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- ç­‰æ¯”æ•¸åˆ—çµ„ä»¶ ---
        const GeometricMode = () => {
            const [a1, setA1] = useState(1);
            const [r, setR] = useState(2);
            const [n, setN] = useState(6);
            const sequence = Array.from({ length: n }, (_, i) => a1 * Math.pow(r, i));
            const maxVal = Math.max(...sequence.map(Math.abs));
            const scale = maxVal > 300 ? 300 / maxVal : 1;

            return (
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 animate-fade-in">
                    <div className="bg-white p-6 rounded-2xl border">
                        <h2 className="text-xl font-bold mb-4 flex items-center gap-2"><Icon name="trending-up" className="text-pink-500" /> ç”Ÿé•·è¨­å®š</h2>
                        <div className="space-y-6">
                            <div>é¦–é … (aâ‚): {a1}<input type="range" min="1" max="5" value={a1} onChange={e=>setA1(parseInt(e.target.value))} className="w-full mt-2" /></div>
                            <div>å…¬æ¯” (r): {r}<input type="range" min="-2" max="3" step="0.5" value={r} onChange={e=>setR(parseFloat(e.target.value))} className="w-full mt-2" /></div>
                            <div>é …æ•¸ (n): {n}<input type="range" min="2" max="10" value={n} onChange={e=>setN(parseInt(e.target.value))} className="w-full mt-2" /></div>
                        </div>
                    </div>
                    <div className="lg:col-span-2 bg-slate-900 p-6 rounded-2xl flex items-center justify-center min-h-[400px] relative">
                        <div className="w-full h-[1px] bg-slate-700 absolute"></div>
                        <div className="flex items-center gap-4">
                            {sequence.map((val, idx) => (
                                <div key={idx} className="relative flex flex-col items-center group">
                                    <div className={`w-1 rounded-full ${val >= 0 ? 'bg-pink-500' : 'bg-cyan-500'}`} style={{ height: `${Math.abs(val) * scale * 20}px` }}></div>
                                    <div className="w-3 h-3 bg-white rounded-full absolute" style={{ bottom: val >= 0 ? `${val * scale * 20}px` : 'auto', top: val < 0 ? `${Math.abs(val) * scale * 20}px` : 'auto' }}></div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // --- æŒ‘æˆ°æ¨¡å¼ ---
        const ChallengeMode = () => {
            const [level, setLevel] = useState(0);
            const [userInput, setUserInput] = useState('');
            const [feedback, setFeedback] = useState(null);
            const questions = [
                { seq: [2, 5, 8, 11], next: 14, hint: "å…¬å·®æ˜¯ 3" },
                { seq: [3, 6, 12, 24], next: 48, hint: "å…¬æ¯”æ˜¯ 2" },
                { seq: [1, 1, 2, 3, 5], next: 8, hint: "å‰å…©é …ç›¸åŠ " }
            ];
            const q = questions[level];
            
            const check = (e) => {
                e.preventDefault();
                if (parseInt(userInput) === q.next) {
                    setFeedback('correct');
                    setTimeout(() => { setLevel(level + 1); setUserInput(''); setFeedback(null); }, 1000);
                } else {
                    setFeedback('wrong');
                }
            };

            if (level >= questions.length) return <div className="text-center p-10 bg-white rounded-2xl shadow">ğŸ‰ å¤ªå¼·äº†ï¼é€šé—œï¼<button onClick={()=>setLevel(0)} className="block mx-auto mt-4 text-blue-600 underline">é‡ç©</button></div>;

            return (
                <div className="max-w-md mx-auto bg-white p-8 rounded-2xl border text-center shadow-sm">
                    <p className="text-sm text-slate-400 mb-4">Level {level + 1}</p>
                    <div className="flex justify-center gap-2 mb-8">
                        {q.seq.map((n, i) => <div key={i} className="w-12 h-12 flex items-center justify-center bg-slate-100 rounded-lg font-bold">{n}</div>)}
                        <div className="w-12 h-12 flex items-center justify-center bg-blue-100 text-blue-600 rounded-lg font-bold animate-pulse">?</div>
                    </div>
                    <form onSubmit={check}>
                        <input type="number" value={userInput} onChange={e=>setUserInput(e.target.value)} className="w-full p-3 border rounded-xl text-center text-xl mb-4" placeholder="ç­”æ¡ˆæ˜¯ï¼Ÿ" />
                        <button className="w-full bg-blue-600 text-white py-3 rounded-xl">é€å‡º</button>
                    </form>
                    {feedback === 'wrong' && <p className="text-red-500 mt-2 text-sm">æç¤ºï¼š{q.hint}</p>}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SequenceLab />);
    </script>
</body>
</html>
